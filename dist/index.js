module.exports=function(r){var e={};function __webpack_require__(t){if(e[t])return e[t].exports;var o=e[t]={i:t,l:!1,exports:{}};return r[t].call(o.exports,o,o.exports,__webpack_require__),o.l=!0,o.exports}return __webpack_require__.m=r,__webpack_require__.c=e,__webpack_require__.d=function(r,e,t){__webpack_require__.o(r,e)||Object.defineProperty(r,e,{enumerable:!0,get:t})},__webpack_require__.r=function(r){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},__webpack_require__.t=function(r,e){if(1&e&&(r=__webpack_require__(r)),8&e)return r;if(4&e&&"object"==typeof r&&r&&r.__esModule)return r;var t=Object.create(null);if(__webpack_require__.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:r}),2&e&&"string"!=typeof r)for(var o in r)__webpack_require__.d(t,o,function(e){return r[e]}.bind(null,o));return t},__webpack_require__.n=function(r){var e=r&&r.__esModule?function getDefault(){return r.default}:function getModuleExports(){return r};return __webpack_require__.d(e,"a",e),e},__webpack_require__.o=function(r,e){return Object.prototype.hasOwnProperty.call(r,e)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=5)}([function(r,e,t){var o=t(1),s=t(8);r.exports=function generateErrorClass(r,e){(e=e||{}).subclass&&console.warn("options.subclass is deprecated. use options.extends instead."),e.extends=e.extends||e.subclass||Error,e.args=e.args||["message","inner_error"],e.generateMessage=e.generateMessage||null,e.globalize=!1!==e.globalize,n(r),a(e.args);var t=new Function("classConstructor",["return function ",r,"(",e.args.join(", "),"){","if(!(this instanceof ",r,")) {","var instance = Object.create(",r,".prototype);","classConstructor.apply(instance, arguments);","return instance;","} else {","classConstructor.apply(this, arguments);","}","};"].join(""))(function classConstructor(){t.super_.call(this),this.global_initialize&&this.global_initialize(t),this.args=arguments;for(var o=0;o<e.args.length;o++)this[e.args[o]]=arguments[o];this.name=r,this.generateMessage&&(this.message=this.generateMessage()),t.captureStackTrace(this,t)});return o.inherits(t,e.extends),t.prototype.generateMessage=e.generateMessage,t.captureStackTrace=function captureStackTrace(r,e){Error.captureStackTrace(r,e),r.inner_error&&r.inner_error.stack&&(r.stack+="\n--- inner error ---\n"+r.inner_error.stack)},e.globalize&&s(t),t};var n=function validateInput(r){if("string"!=typeof r||!/^[\-\w]+$/.test(r))throw new Error("Unsafe or invalid string '"+(r||"").toString()+"' used to generate Error class.")},a=function validateArrayInput(r){if(!r||!Array.isArray(r))throw new Error("Unsafe or invalid args used to generate Error class.");for(var e=0;e<r.length;e++)n(r[e])}},function(r,e){r.exports=require("util")},function(r,e,t){var o=t(0);r.exports=o("ArgumentError",{args:["argumentName","inner_error"],generateMessage:function(){return"Invalid or missing argument supplied: "+this.argumentName}})},function(r,e,t){r.exports=t(0)("IOError")},function(r,e,t){var o=t(10),s=t(1),n=r.exports.STATUS_CODE_ATTRIBUTE_NAME="status",a=r.exports=function HttpStatusError(r,e){if(!(this instanceof HttpStatusError)){var t=Object.create(HttpStatusError.prototype);return HttpStatusError.apply(t,arguments),t}if("number"==typeof e&&"number"!=typeof r){var o=e;e=r,r=o}else if(r instanceof Error){var s=r,a=e;"number"!=typeof(r=s.statusCode||s.status_code||s[n])&&("function"==typeof(r=i[s.name])&&(r(s,a),r=s.status_code),r=r||500),e=s.message,this.stack=s.stack}this.status_code=this.statusCode=this[n]=r||500,this.name="HttpStatusError";var c="("+this.status_code+") "+u[r]||!1;this.message=e||c,this.stack||Error.captureStackTrace(this,HttpStatusError),e&&(this.stack=c+"\n"+this.stack)};s.inherits(a,Error);var i=a.code_map={ValidationError:400,ArgumentError:400,AuthenticationRequiredError:401,NotPermittedError:403,ArgumentNullError:function(r,e){var t=e&&e.method||"GET",o=e&&e.params||{},s=e&&e.route&&e.route.path||"";/GET|HEAD/i.test(t)||o.hasOwnProperty(r.argumentName)||new RegExp(":"+r.argumentName).test(s+"/")?r.status_code=404:r.status_code=400,r.message=r.message.replace(new RegExp("^Missing argument: ("+r.argumentName+")$"),'Not Found: "$1"')},NotFoundError:404,NotSupportedError:405,AlreadyInUseError:409},c={};Object.keys(o.STATUS_CODES).forEach(function(r){c[r]=o.STATUS_CODES[r]});var u=a.message_map=c},function(r,e,t){const{BadRequestError:o,BadAccountError:s,ConflictError:n,ForbiddenError:a,ProxyError:i,UnauthorizedError:c,NotFoundError:u,ServiceUnavailableError:l,NotAcceptableError:g}=t(6);r.exports=class BaseController{constructor(r){this.logger=r}get HTTP(){return{OK:200,BAD_REQUEST:400,UNAUTHORIZED:401,FORBIDDEN:403,NOT_FOUND:404,NOT_ACCEPTABLE:406,CONFLICT:409,INTERNAL_SERVER_ERROR:500,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504}}getLogLevelFromStatusCode(r){const e={2:"info",3:"info",4:"warn",5:"error"},t=r?r.toString()[0]:void 0;return t&&e[t]?e[t]:"error"}createResponseModel(r,e){const t=this.getLogLevelFromStatusCode(r);return this.logger[t]("Creating response",{statusCode:r,body:e},this.constructor.name),{body:e,statusCode:r,headers:{"Access-Control-Allow-Origin":"*"}}}createSuccessResponse(r){return this.createResponseModel(this.HTTP.OK,{result:r})}createErrorResponse(r,e,t){return"string"!=typeof t&&(t=t&&t.message||t),this.createResponseModel(r,{errorCode:r,message:e,data:t})}createUnexpectedErrorResponse(r){return this.createErrorResponse(this.HTTP.INTERNAL_SERVER_ERROR,"An unexpected error occurred!",r)}handleServiceErrors(r){let e=r.name||"Unnamed Error";return r instanceof o?(this.logger.warn(e,r,this.constructor.name),this.createErrorResponse(this.HTTP.BAD_REQUEST,r.message)):r instanceof c?(this.logger.warn(e,r,this.constructor.name),this.createErrorResponse(this.HTTP.UNAUTHORIZED,r.message)):r instanceof n?(this.logger.warn(e,r,this.constructor.name),this.createErrorResponse(this.HTTP.CONFLICT,r.message)):r instanceof i?(this.logger.error(e,r,this.constructor.name),this.createErrorResponse(this.HTTP.GATEWAY_TIMEOUT,r.message)):r instanceof s?(this.logger.warn(e,r,this.constructor.name),this.createErrorResponse(this.HTTP.FORBIDDEN,r.message)):r instanceof a?(this.logger.warn(e,r,this.constructor.name),this.createErrorResponse(this.HTTP.FORBIDDEN,r.message)):r instanceof u?(this.logger.warn(e,r,this.constructor.name),this.createErrorResponse(this.HTTP.NOT_FOUND,r.message)):r instanceof l?(this.logger.error(e,r,this.constructor.name),this.createErrorResponse(this.HTTP.SERVICE_UNAVAILABLE,r.message)):r instanceof g?(this.logger.warn(e,r,this.constructor.name),this.createErrorResponse(this.HTTP.NOT_ACCEPTABLE,r.message)):(this.logger.error(e,r,this.constructor.name),this.createUnexpectedErrorResponse(r))}verifyRequiredParameters(r,e,t){let s=[];if(this.logger.trace("BaseController.verifyRequiredParameters() called",{qs:e,body:t},this.constructor.name),r.body)try{r.body=JSON.parse(r.body)}catch(r){throw new o(r.message)}if(r.headers){let e="correlation-object";Object.keys(r.headers).forEach(r=>{r.toLowerCase()===e&&(e=r)});try{if(r.correlationObject=JSON.parse(r.headers[e]),!r.correlationObject.correlationId)throw new Error}catch(r){s.push("A Correlation-Object header is required in the request.")}}else s.push("Event headers are missing or malformed.");function processPropertySet(e,t){let o=r[e];t&&t.length>0&&(null==o?s.push(`Request event is malformed. The ${e} object is missing.`):t.forEach(r=>{o[r]||s.push(`The parameter ${r} is required in the Request's ${e}.`)}))}if(processPropertySet("queryStringParameters",e),processPropertySet("body",t),s.length>0)throw new o(s.join(" "))}}},function(r,e,t){const{helpers:o}=t(7);r.exports={BadRequestError:o.generateClass("BadRequestError"),BadAccountError:o.generateClass("BadAccountError"),ConflictError:o.generateClass("ConflictError"),ForbiddenError:o.generateClass("ForbiddenError"),ProxyError:o.generateClass("ProxyError"),UnauthorizedError:o.generateClass("UnauthorizedError"),NotFoundError:o.generateClass("NotFoundError"),ServiceUnavailableError:o.generateClass("ServiceUnavailableError"),NotAcceptableError:o.generateClass("NotAcceptableError")}},function(r,e,t){t(1);(e=r.exports={helpers:{generateClass:t(0)},middleware:{errorHandler:t(9),crashProtector:t(11)}}).AlreadyInUseError=e.AlreadyInUse=t(13),e.ArgumentError=e.Argument=t(2),e.ArgumentNullError=e.ArgumentNull=t(14),e.AuthenticationRequiredError=e.AuthenticationRequired=t(15),e.ConnectionError=e.helpers.generateClass("ConnectionError"),e.Error=e.helpers.generateClass("Error"),e.HttpStatusError=e.HttpStatus=t(4),e.InvalidOperationError=t(16),e.NotFoundError=t(17),e.NotImplementedError=e.helpers.generateClass("NotImplementedError"),e.NotSupportedError=e.NotSupported=t(18),e.NotPermittedError=e.NotPermitted=t(19),e.OutOfMemoryError=e.helpers.generateClass("OutOfMemoryError"),e.RangeError=e.helpers.generateClass("RangeError",{extends:RangeError}),e.ReferenceError=e.helpers.generateClass("ReferenceError",{extends:ReferenceError}),e.StackOverflowError=e.helpers.generateClass("StackOverflowError"),e.SyntaxError=e.helpers.generateClass("SyntaxError",{extends:SyntaxError}),e.TimeoutError=t(20),e.TypeError=e.helpers.generateClass("TypeError",{extends:TypeError}),e.URIError=e.helpers.generateClass("URIError",{extends:URIError}),e.ValidationError=e.Validation=t(21),e.io={IOError:t(3)},e.io.DirectoryNotFoundError=e.helpers.generateClass("DirectoryNotFoundError",{extends:e.io.IOError}),e.io.DriveNotFoundError=e.helpers.generateClass("DriveNotFoundError",{extends:e.io.IOError}),e.io.EndOfStreamError=e.helpers.generateClass("EndOfStreamError",{extends:e.io.IOError}),e.io.FileLoadError=t(22),e.io.FileNotFoundError=t(23),e.io.SocketError=e.helpers.generateClass("SocketError",{extends:e.io.IOError}),e.data={DataError:t(24)},e.data.MemcachedError=e.helpers.generateClass("MemcachedError",{extends:e.data.DataError}),e.data.MongoDBError=e.helpers.generateClass("MongoDBError",{extends:e.data.DataError}),e.data.RedisError=e.helpers.generateClass("RedisError",{extends:e.data.DataError}),e.data.RollbackError=e.helpers.generateClass("RollbackError",{extends:e.data.DataError}),e.data.SQLError=e.helpers.generateClass("SQLError",{extends:e.data.DataError}),e.data.TransactionError=e.helpers.generateClass("TransactionError",{extends:e.data.DataError}),e.Generic=e.helpers.generateClass("GenericError");var o=!1;r.exports.logError=function(r,e){o||console.warn("logError is deprecated.  Use log instead."),o=!0,r&&!r.isLogged&&(r.isLogged=!0,console.error(r)),e&&e(r)},r.exports.log=function(e,t){return"string"==typeof e?e=new r.exports.Error(e):(t&&(e.message=t),e=r.exports.prependCurrentStack(e,3)),e&&(console.error(e&&e.stack||e),e.isLogged=!0),e},r.exports.prependCurrentStack=function(r,e){var t=void 0===e?2:e,o=(new Error).stack.split("\n").slice(t),s=(r.stack||"").split("\n"),n=s.shift();return r.stack=[n].concat(o,"====",s).join("\n"),r}},function(r,e,t){t(1);var o="__COMMON-ERRORS-TYPES__",s=global[o]=global[o]||{};r.exports=function global_extend(r){r.__original_prototype__=r.prototype;var e=s[r.name]=s[r.name]||r;r.prototype=r.__global_prototype__=e.prototype,r.prototype.global_initialize=r.prototype.global_initialize||function global_initialize(r){for(var e=Object.keys(r.__original_prototype__),t=0;t<e.length;t++){var o=e[t];this[o]=r.__original_prototype__[o]}}}},function(r,e,t){var o=t(4);r.exports=function errorHandler(r,e,t,s){if(!r)return s?s():t.end();(r=new o(r,e)).status_code>=500&&(console.error(r.stack),r.message=o.message_map[500]),t.status(r.status_code).send(r.message)}},function(r,e){r.exports=require("http")},function(r,e,t){r.exports=function(r){return function crashProtector(e,o,s){var n=t(12).create();n.on("error",function(t){if(console.error("Fatal crash protected!"),n.dispose(),o.finished||Object.keys(o._headers).length)return console.error(t&&t.stack),o.end();r?r(t,e,o):s(t)}),n.run(s)}}},function(r,e){r.exports=require("domain")},function(r,e,t){var o=t(0);r.exports=o("AlreadyInUseError",{args:["entity_name","arg1","arg2","arg3","arg4"],generateMessage:function(){var r=Array.prototype.slice.call(this.args,1);return"The specified '"+this.entity_name+"' value is already in use for: "+r.join(", ")}})},function(r,e,t){var o=t(0);r.exports=o("ArgumentNullError",{args:["argumentName","inner_error"],extends:t(2),generateMessage:function(){return"Missing argument: "+this.argumentName}})},function(r,e,t){var o=t(0);r.exports=o("AuthenticationRequiredError",{args:["message","inner_error"],generateMessage:function(){return"An attempt was made to perform an operation without authentication: "+this.message}})},function(r,e,t){var o=t(0);r.exports=o("InvalidOperationError",{args:["message","inner_error"],generateMessage:function(){return"Invalid Operation: "+this.message}})},function(r,e,t){var o=t(0);r.exports=o("NotFoundError",{args:["entity_name","inner_error"],generateMessage:function(){return'Not Found: "'+this.entity_name+'"'}})},function(r,e,t){var o=t(0);r.exports=o("NotSupportedError",{args:["message","inner_error"],generateMessage:function(){return"Not Supported: "+this.message}})},function(r,e,t){var o=t(0);r.exports=o("NotPermittedError",{args:["message","inner_error"],generateMessage:function(){return"An attempt was made to perform an operation that is not permitted: "+this.message}})},function(r,e,t){var o=t(0);r.exports=o("TimeoutError",{args:["time","inner_error"],generateMessage:function(){return/^\d/.test(this.time)?"Timeout of '"+this.time+"' exceeded":"Timeout exceeded: "+this.time}})},function(r,e,t){var o=t(0),s=t(2),n=r.exports=o("ValidationError",{args:["message","code","field"]});n.prototype.addError=function addError(r){return this.errors=this.errors||[],this.errors.push(r),this},n.prototype.addErrors=function addErrors(r){if(!(r instanceof Array))throw new s("errors");return this.errors=this.errors||[],Array.prototype.push.apply(this.errors,r),this},n.prototype.generateMessage=function generateMessage(){return this.message||"Validation failed."},n.prototype.toJSON=function toJSON(){var r={};return this.errors?(this.message&&(r.message=this.message),r.errors=this.errors.map(function(r){return r.toJSON()})):(this.message&&(r.text=this.message),this.code&&(r.code=this.code),this.field&&(r.field=this.field)),r}},function(r,e,t){var o=t(0);r.exports=o("FileLoadError",{args:["file_name","inner_error"],extends:t(3),generateMessage:function(){return"Unable to load file: "+this.file_name}})},function(r,e,t){var o=t(0);r.exports=o("FileNotFoundError",{args:["file_name","inner_error"],extends:t(3),generateMessage:function(){return"File not found: "+this.file_name}})},function(r,e,t){r.exports=t(0)("DataError")}]);
//# sourceMappingURL=index.js.map